# λ計算専用ハードウェアの可能性と限界

*作成日: 2026-01-17*
*ステータス: 初稿*

## 概要

LOSのために専用ハードウェアを作れば、より本質的にλ計算を実行できるか？この問いは歴史的に何度も試みられてきた。本ドキュメントでは、過去の試みとその結末、現代における可能性、そしてLOSへの示唆をまとめる。

---

## 歴史的な専用ハードウェアの試み

### Lispマシン（1970-80年代）

```
MIT CADR → Symbolics, LMI, TI Explorer
```

#### 特徴
- タグ付きメモリ（型情報をハードウェアで保持）
- ガベージコレクション支援
- マイクロコードでLisp最適化
- 専用開発環境との統合

#### 結末
汎用CPUの高速化に負けて消滅（1990年代）。Symbolicsは2000年代まで細々と存続したが、実質的には1980年代後半に敗北が確定していた。

### グラフ簡約マシン

関数型言語、特に遅延評価言語のために設計されたハードウェア。

| マシン | 特徴 | 時期 | 開発元 |
|--------|------|------|--------|
| **SKIM** | コンビネータ直接実行 | 1970s | ケンブリッジ |
| **GRIP** | 並列グラフ簡約 | 1980s | UCL |
| **ALICE** | 分散グラフ簡約 | 1980s | Imperial College |
| **Reduceron** | Haskell用FPGA実装 | 2008 | York大学 |

#### Reduceron について

最も新しい試みとして注目に値する。

- FPGAでHaskellのグラフ簡約を直接実行
- テンプレートインスタンス化を並列実行
- 学術的には興味深い結果を残した
- しかし汎用CPUには性能で勝てず

### データフローマシン

命令列ではなく、データの依存関係に基づいて計算を進めるアーキテクチャ。

- **MIT Tagged Token Dataflow Architecture**
- **Manchester Dataflow Machine**
- **Sigma-1** (日本の第五世代コンピュータプロジェクト)

#### データフローの思想

```
従来: 命令を順番に実行
データフロー: データが揃ったら計算を発火

→ 暗黙の並列性を自動的に抽出
```

関数型言語との親和性は高いが、実用化には至らなかった。

---

## なぜ全て失敗したか

### 1. ムーアの法則との競争

```
専用ハードウェア開発: 5年かかる
その間に汎用CPU: 10倍速くなる
→ 完成時には汎用CPUの方が速い
```

専用ハードウェアは開発サイクルが長く、その間に汎用CPUが追いついてしまう。

### 2. エコシステムの不在

- **少量生産** → 高コスト → 普及しない
- **ソフトウェア資産がない** → ユーザーが移行しない
- **開発者がいない** → ソフトウェアが充実しない

悪循環に陥り、抜け出せなくなる。

### 3. コンパイラ技術の進歩

```
1980年代: λ計算 → 機械語 = 非効率（直接的な翻訳）
2020年代: GHC等の最適化 = かなり効率的
```

特にGHCで採用されているSTG（Spineless Tagless G-machine）などの中間表現により、汎用ハードウェア上でも効率的な実行が可能になった。

ハードウェアで解決しようとした問題の多くが、ソフトウェア（コンパイラ）で解決できるようになった。

### 4. 汎用性の価値

専用ハードウェアは特定の計算モデルには最適だが、他の用途には使えない。汎用CPUは「何でもそこそこ」できることに価値がある。

---

## 「より本質的」とは何か？

### 理論的な観点: Yes

```
Von Neumannアーキテクチャ:
- 命令列を順次実行
- メモリに状態を保持
- 状態を変更しながら計算

λ計算:
- 式を簡約（書き換え）
- 状態なし（参照透過）
- 置換によって計算が進む
```

専用ハードウェアなら:
- グラフ簡約をネイティブに実行
- サンク（遅延評価のための未評価式）をハードウェアで管理
- 線形型のリソース追跡をハードウェアレベルで実施
- ガベージコレクションをハードウェア支援

### 実用的な観点: No

```
「本質的」≠「実用的」
「本質的」≠「高速」
「本質的」≠「実現可能」
```

計算モデルとしての「本質」と、実用システムとしての「価値」は別の軸である。

---

## 現代の可能性

### アプローチの比較

| アプローチ | 現実性 | 効果 | コスト |
|-----------|--------|------|--------|
| 完全専用CPU | 低 | 理論的には高い | 極めて高い |
| アクセラレータ | 中 | 特定処理のみ高速化 | 中程度 |
| FPGA実装 | 中 | 実験・教育用途 | 中程度 |
| 既存CPU + 良いコンパイラ | 高 | 十分実用的 | 低い |

### 現代で意味がありそうな方向

1. **効果ハンドラのハードウェア支援**
   - 継続の捕捉・復元を高速化
   - 現在はソフトウェアで実装（オーバーヘッドあり）

2. **線形型チェックのハードウェア支援**
   - リソースの使用回数をハードウェアで追跡
   - use-after-freeを物理的に防止

3. **ガベージコレクションの支援**
   - 既にいくつかのCPUで部分的に実装（Azul Vega等）

ただし、これらは「専用CPU」ではなく「アクセラレータ」や「CPU拡張」としての実現可能性を探る方向。

---

## LOSへの示唆

### 現実的な選択

```
専用ハードウェア: 研究としては面白いが、実用OSにはならない
既存ハードウェア: 制約はあるが、届く人が多い
```

LOSが目指すべきは「広く使われるOS」であり、そのためには既存ハードウェア上で動作することが必須条件。

### より深い問い

**「本質的」にこだわる必要があるか？**

```
目的: λ計算的思考でOSを設計する
手段: 必ずしも専用ハードウェアではない

抽象化レイヤーで「λ計算的インターフェース」を提供できれば、
実装がVon Neumannでも問題ない
```

### Haskellの教訓

```
Haskell:
- 表面: 純粋関数型、遅延評価、λ計算的
- 実装: STGマシン → C-- → 機械語（命令的）

プログラマには「λ計算的」に見える
実行は「Von Neumann的」でも構わない
```

これは重要な洞察である。**抽象化が適切であれば、実装の詳細は隠蔽できる。**

### 抽象化の力

```
ユーザー/アプリ
    ↓ λ計算的インターフェース（純粋関数、効果、線形型）
LOS カーネル
    ↓ 翻訳・最適化
Von Neumannハードウェア
```

この構造であれば、将来専用ハードウェアが登場した場合でも、上位レイヤーは変更不要。

---

## 結論

| 観点 | 専用ハードウェア | 既存ハードウェア |
|------|-----------------|-----------------|
| 本質的か | ○ より本質的 | △ 翻訳が必要 |
| 実現可能か | × 歴史的に全滅 | ○ 現実的 |
| 速度 | ? 不明 | ○ 十分速い |
| 到達範囲 | × 極めて狭い | ○ 広い |
| 将来性 | △ 研究テーマとして | ○ 今すぐ始められる |

### LOSの賢明な選択

**既存ハードウェア上で「λ計算的抽象化」を提供する。**

ただし、設計においては以下を考慮する:

1. **抽象化を適切に設計する** - 将来のハードウェア変更に対応可能に
2. **特定ハードウェアに依存しない** - 移植性を確保
3. **将来の拡張を排除しない** - FPGAやアクセラレータとの統合の余地を残す

### 研究テーマとしての価値

将来的に以下は研究テーマとして面白い:

- 効果ハンドラのFPGA実装
- 線形型チェックのハードウェア支援
- グラフ簡約アクセラレータ

これらはLOSの「オプショナルな高速化」として位置づけられる。

---

## 参考文献

- Steele, G. L., & Gabriel, R. P. (1993). The evolution of Lisp.
- Peyton Jones, S. L. (1987). The Implementation of Functional Programming Languages.
- Naylor, M., & Runciman, C. (2008). The Reduceron: Widening the von Neumann bottleneck for graph reduction using an FPGA.
- Culler, D. E., et al. (1993). TAM: A compiler controlled threaded abstract machine.

---

*このドキュメントは、専用ハードウェアの歴史的試みと失敗、そしてLOSが取るべき現実的なアプローチについてまとめたものである。*
